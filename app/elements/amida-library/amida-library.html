<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="amida-library">
  <style>
    :host {
      display: block;
      /*@apply(--layout-vertical)*/
      width:420px;
    }
    paper-material{
      margin: 8px 8px;
      padding: 8px 8px;
    }
    paper-button{
      background: rgba(180,180,180,.8);
      /*font-size: 1.2em;*/
      /*@apply(--layout-flex);*/
      /*max-width:30%;
      min-width: 30%;*/
    }
    paper-button::shadow paper-ripple{
      color: white;
    }
    paper-material{
      /*@apply(--layout-horizontal);*/
      /*@apply(--layout-justified);*/
    }
    span{
      @apply(--layout-center);
    }
    #description{
      font-size:.8em;
    }
    #repo_name{
      cursor: pointer;
      cursor: hand;
    }
  </style>
  <template>
    <paper-material elevation="1" animated class="layout vertical">
      <div class="layout horizontal">
      <paper-item class="paper-font-display2" id="repo_name" on-tap="onClick"><h2>{{name}}</h2></paper-item>
        <iron-image class="self-center"src="{{travisPath(name)}}"></iron-image>
      </div>
      <a id="npm_link"href="{{npmjsPath(name)}}">
        <img id="npm_img"

          src="{{npmPath(name)}}"
          on-error="imgError"></img>
      </a>
      <span id="description">{{description}}</span>
    </paper-material>
  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'amida-library',

    properties: {
      loaded: {
        type: Boolean,
        notify: true,
        observer: 'loadedChanged'
      },
      loading: {
        type: Boolean,
        notify: true,
        observer: 'loadingChanged'
      },
      name: String,
      url: String,
      description: String
    },
    imgError: function(e){
      console.log(e)
      e.target.style.display = "none";
    },
    _computeTitle: function(name, description){
      return name + " - " + description;
    },
    created: function(){
    },
    onClick: function(){
      location.href = this.url;
    },
    travisPath: function(name){
      // return 'https://travis-ci.org/amida-tech/' + DRE.svg
      return "https://travis-ci.org/amida-tech/"+ name + ".svg";
    },
    npmPath: function(name){
      // return 'https://travis-ci.org/amida-tech/' + DRE.svg
      return "https://nodei.co/npm/"+ name + ".png";
    },
    npmjsPath: function(name){
      // return 'https://travis-ci.org/amida-tech/' + DRE.svg
      return "https://nodei.co/npm/"+ name ;
    },
    ready: function(){
      // this.$.npm_img.style.display = "none";
      // this.$.npm_link.style.display = "none";
    },
    loadingChanged: function(loading){
      // console.log("loadingchange: ",loading);
      // console.log("loaded: ",loaded);
      // console.log(this.$.npm_img.src)
    //   if(loading){
    //     // this.$.npm_link.style.display = "none";
    //     this.$.npm_img.style.display = "none";
    //   } else {
    //     this.$.npm_img.style.display = "display";
    //   }
      // this.checkFor404();

    },
    loadedChanged: function(loaded){
      // console.log("loadedchange: ",loaded);
      if(loaded === true){
        console.log("loaded: ",loaded);
        console.log(this.$$('img'))
        // this.$.npm_link.style.display = "none";
        this.$.npm_img.style.display = "display";
      }
      // this.checkFor404();
    },
    checkFor404: function(){
      // // if(this.loading && this.loaded){
      // //   console.log(this.loading,this.loaded)
      // //   // this.$.npm_img.style.display = "none";
      // //   // this.$.npm_link.style.display = "none";
      // //   console.log(this.$.npm_img.src)
      // // }
      // if(!this.loading && this.loaded){
      //   console.log(this.loading,this.loaded)
      //
      //   this.$.npm_img.style.display = "display";
      //   // this.$.npm_link.style.display = "display";
      //   console.log(this.$.npm_img.src)
      // }
      // if(this.loading === true && this.loaded === false){
      //   console.log(this.loading,this.loaded)
      //
      //   // this.$.npm_img.style.display = "none";
      //   // this.$.npm_link.style.display = "none";
      //   console.log(this.$.npm_img.src)
      // }
      // // if(this.loading && !this.loaded){
      // //   console.log(this.loading,this.loaded)
      // //
      // //   // this.$.npm_img.style.display = "none";
      // //   // this.$.npm_link.style.display = "none";
      // //   console.log(this.$.npm_img.src)
      // // }
    },
    calcImageWidth: function(){
      console.log(loading)
    },
    calcImageHeight: function(){

    }
  });
})();
</script>
