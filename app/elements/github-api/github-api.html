<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="github-api">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>
    <div>Hello from <span>{{name}}</span></div>
    <iron-ajax id="ajax"
      auto
      url="{{_computeUrl(baseUrl,endpoint)}}"
      handle-as="json"
      on-response="handleResponse"
      ></iron-ajax>
  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'github-api',

    properties: {
      name: {
        type: String,
        value: 'github-api',
        notify: true
      },
      baseUrl:{
        type: String,
        value: 'https://api.github.com',
        notify: true
      },
      endpoint:{
        type: String,
        value:"/",
        notify: true
      },
      amida:{
        type: Object,
        notify: true,
        observer: '_amidaChanged',
        reflectToAttribute: true
      },
      amidarepos:{
        type: Array,
        notify: true,
        reflectToAttribute: true,
        observer: '_amidareposChanged',
      },
      drereadme:{
        type: Array,
        notify: true,
        reflectToAttribute: true,
        observer: '_drereadmeChanged',
      }
    },
    /**
     * [handleResponse description]
     * @param {event} e [description]
     */
    handleResponse: function(e){

        if (this.amida === undefined){
          // console.log('assigning "this.amida"');
          this.amida = e.detail.response;
          this.endpoint = '/users/amida-tech/repos';
        }
        else if(this.amidarepos === undefined){
          // console.log('assigning "this.amida.repos"');
          // this.amidaRepos = [];
          this.amidarepos = e.detail.response;
          this.endpoint = '/repos/amida-tech/DRE/readme';
        }
        else if(this.drereadme === undefined){
          // console.log(e.detail.response)
          // console.log()
          this.drereadme = atob(e.detail.response.content);
        }
        else{

        }

      // console.log('reponse',e.detail.response);
    },
    _computeUrl: function(base,end){
      return base + end;
    },
    _amidaChanged: function(newVal,oldVal,el){
      // console.log("github-api.amida changed",newVal);
    },
    _amidareposChanged: function(newVal,oldVal,el){
      // console.log("github-api.amidarepos changed",newVal);
    },
    _drereadmeChanged: function(newVal,oldVal,el){

    }
  });
})();
</script>
